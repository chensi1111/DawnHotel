import{_ as F,a as y,L as q,B as H,o as J,W,u as X,c as C,X as Z,Q as G,d,e as _,i as t,k as i,s as R,F as K,g as ee,f as I,M as se,Y as te,h as oe,w as b,I as S,t as l,p as ae,j as ne,J as h,E as re,O,C as w,H as V,Z as ce,z as k}from"./index-Bj6ZKCGR.js";import{a as le,c as ue}from"./classic-2-D3YjDJ3h.js";import{a as ie,l as de}from"./luxuary-2-B0S4pv-g.js";import{a as pe,m as _e}from"./mountain-2-CbkBAbDl.js";import{a as he,o as ve}from"./ocean-2-DkZglmbB.js";const M=v=>(ae("data-v-c8b912bb"),v=v(),ne(),v),me={class:"list"},fe=M(()=>t("div",{class:"title"},"訂單列表",-1)),ge={class:"container"},ye=M(()=>t("br",null,null,-1)),De={class:"order-title"},Ce={class:"time"},Re={class:"order"},be={class:"pic"},we=["src"],ke=["onClick"],xe={class:"info-container"},Pe={class:"info"},Be={class:"info"},Ie={class:"info"},Se={class:"info"},Oe={class:"info"},Ve=["onClick"],E=6,Ee={__name:"infoList",setup(v){const x=y(""),T=e=>{switch(e){case"經典雙人套房":return ue;case"經典四人套房":return le;case"豪華雙人套房":return de;case"豪華四人套房":return ie;case"山景雙人套房":return _e;case"山景四人套房":return pe;case"海景雙人套房":return ve;case"海景四人套房":return he}},m=y(1),P=q(()=>{const e=(m.value-1)*E,o=e+E;return p.value.slice(e,o)}),N=e=>{m.value=e},D=H();J(()=>{W(D,e=>{e?Q(e.uid):console.error("無登入狀態")})});const f=y(!1),p=y([]),Q=async e=>{f.value=!0;const o=se(h,"users",e,"userOrders"),r=await te(o),a=[];r.forEach(c=>{const n=c.data();if(n.id=c.id,!n.state)n.state="訂單已送出";else if(n.state==="訂單已取消")n.state="訂單已取消";else return;a.push(n)}),a.sort((c,n)=>new Date(n.orderDate)-new Date(c.orderDate)),p.value=a,f.value=!1},Y=e=>{switch(e){case"經典雙人套房":return"classicDoubleRoomCounts";case"經典四人套房":return"classicQuadrupleRoomCounts";case"豪華雙人套房":return"luxuryDoubleRoomCounts";case"豪華四人套房":return"luxuryQuadrupleRoomCounts";case"山景雙人套房":return"mountainDoubleRoomCounts";case"山景四人套房":return"mountainQuadrupleRoomCounts";case"海景雙人套房":return"oceanDoubleRoomCounts";case"海景四人套房":return"oceanQuadrupleRoomCounts"}},z=(e,o)=>{const r=[];let a=k(e);const c=k(o);for(;a.isBefore(c);)r.push(a.toDate()),a=a.add(1,"day");return r},L=e=>{re.confirm("確定要取消訂單嗎?","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(async()=>{O({type:"success",message:"訂單已取消"}),e.state="訂單已取消";const o=D.currentUser.uid,r=w(h,"users",o,"userOrders",e.id);await V(r,{state:"訂單已取消"});const a=Y(e.room),c=e.number,n=w(h,"counts",a);await ce(h,async s=>{const g=await s.get(n);if(!g.exists())throw"數據不存在";const u=g.data();z(e.date1,e.date2).forEach(A=>{const B=k(A).format("YYYY-MM-DD");u[B]!==void 0&&(u[B]+=parseInt(c))}),s.update(n,u)})}).catch(()=>{O({type:"error",message:"取消失敗"})})},U=async e=>{e.state="訂單已刪除";const o=D.currentUser.uid,r=w(h,"users",o,"userOrders",e.id);await V(r,{state:"訂單已刪除"}),p.value=p.value.filter(a=>a.id!==e.id)},$=X();function j(){$.push({path:"/reserve"})}return(e,o)=>{const r=C("el-collapse-item"),a=C("el-collapse"),c=C("el-pagination"),n=Z("loading");return G((d(),_("div",me,[fe,t("div",ge,[!f.value&&!P.value.length?(d(),_("div",{key:0,class:"empty",onClick:j},[i(" 尚無任何訂單"),ye,i("來去看看 ")])):R("",!0),(d(!0),_(K,null,ee(P.value,(s,g)=>(d(),oe(a,{key:g,modelValue:x.value,"onUpdate:modelValue":o[0]||(o[0]=u=>x.value=u),accordion:""},{default:b(()=>[I(r,null,{title:b(()=>[t("div",De,[t("span",{style:S({textDecoration:s.state==="訂單已取消"?"line-through":"none"})},"訂單編號: "+l(s.id.slice(0,10)),5),t("span",Ce,l(s.orderDate),1)])]),default:b(()=>[t("div",Re,[t("div",be,[t("img",{src:T(s.room)},null,8,we),s.state!="訂單已取消"?(d(),_("div",{key:0,class:"cancle",onClick:u=>L(s)}," 取消訂單 ",8,ke)):R("",!0)]),t("div",xe,[t("div",Pe,[i(" 入住房型: "),t("span",null,l(s.room),1)]),t("div",Be,[i(" 入住時間: "),t("span",null,l(s.date1)+"~"+l(s.date2),1)]),t("div",Ie,[i(" 房間數量: "),t("span",null,l(s.number),1)]),t("div",Se,[i(" 價格: "),t("span",null,"$"+l(s.total),1)]),t("div",Oe,[i(" 狀態: "),t("span",{style:S({color:s.state==="訂單已取消"?"red":"black"})},l(s.state),5),s.state==="訂單已取消"?(d(),_("span",{key:0,class:"delete",onClick:u=>U(s)},"刪除訂單",8,Ve)):R("",!0)])])])]),_:2},1024)]),_:2},1032,["modelValue"]))),128))]),I(c,{layout:"prev, pager, next",total:p.value.length,"page-size":6,"current-page":m.value,"onUpdate:currentPage":o[1]||(o[1]=s=>m.value=s),onCurrentChange:N},null,8,["total","current-page"])])),[[n,f.value]])}}},Le=F(Ee,[["__scopeId","data-v-c8b912bb"]]);export{Le as default};
