import{C as A,a as K,L as J,b as W,M as G,c as H,O as X,d as Z}from"./ocean-2-CONVmRj5.js";import{_ as ee,m as oe,a as n,y as x,r as ae,o as w,B as se,u as te,c as E,d as I,e as g,i as e,F as M,g as L,P as ne,C as N,D as T,z as f,t as i,I as ce,f as V,w as re,p as le,j as ue,J as F,E as Q}from"./index-Bj6ZKCGR.js";const d=b=>(le("data-v-035f933d"),b=b(),ue(),b),ie=d(()=>e("div",{class:"title"},"搜尋結果",-1)),de={class:"container"},me={class:"top"},ve=["src"],_e={class:"bottom"},pe={class:"name"},fe={class:"info-container"},he={class:"info"},be=d(()=>e("div",{class:"block"},"入住日期:",-1)),ye={class:"info"},De=d(()=>e("div",{class:"block"},"退房日期:",-1)),Ce={class:"info"},ke=d(()=>e("div",{class:"block"},"入住天數:",-1)),xe={class:"info"},Ie=d(()=>e("div",{class:"block"},"平日:",-1)),ge={class:"info"},Pe=d(()=>e("div",{class:"block"},"假日:",-1)),Re={class:"info"},Me=d(()=>e("div",{class:"block"},"剩餘間數:",-1)),Se={class:"info"},qe=d(()=>e("div",{class:"block"},"訂購間數:",-1)),Be={class:"total"},Oe=["onClick"],Ye={__name:"reserveSearch",setup(b){const _=oe(),u=n(_.query.date1),m=n(_.query.date2),v=n(_.query.room);x([()=>_.query.date1,()=>_.query.date2,()=>_.query.room],([o,c,s])=>{u.value=o,m.value=c,v.value=s,R(),q()});const P=o=>new Intl.NumberFormat("en-US").format(o),U=o=>f(o).format("YYYY/MM/DD"),S=ae([{pic:A,name:"經典雙人套房",price:"4000",route:"/room/room-classic",id:"classic",number:n(1)},{pic:K,name:"經典四人套房",price:"5600",route:"/room/room-classic",id:"classic2",number:n(1)},{pic:J,name:"豪華雙人套房",price:"6600",route:"/room/room-luxuary",id:"luxuary",number:n(1)},{pic:W,name:"豪華四人套房",price:"12000",route:"/room/room-luxuary",id:"luxuary2",number:n(1)},{pic:G,name:"山景雙人套房",price:"4600",route:"/room/room-mountain",id:"mountain",number:n(1)},{pic:H,name:"山景四人套房",price:"6200",route:"/room/room-mountain",id:"mountain2",number:n(1)},{pic:X,name:"海景雙人套房",price:"5000",route:"/room/room-ocean",id:"ocean",number:n(1)},{pic:Z,name:"海景四人套房",price:"6600",route:"/room/room-ocean",id:"ocean2",number:n(1)}]),y=n([]),R=()=>{v.value==="全部"?y.value=S:y.value=S.filter(o=>o.name===v.value)};x(()=>v.value,R),w(()=>{R()});const h=n({}),D=n(0),q=async()=>{const o=ne.service({lock:!0,text:"Loading...",background:"rgba(0, 0, 0, 0.5)"}),c={經典雙人套房:"classicDoubleRoomCounts",經典四人套房:"classicQuadrupleRoomCounts",豪華雙人套房:"luxuryDoubleRoomCounts",豪華四人套房:"luxuryQuadrupleRoomCounts",山景雙人套房:"mountainDoubleRoomCounts",山景四人套房:"mountainQuadrupleRoomCounts",海景雙人套房:"oceanDoubleRoomCounts",海景四人套房:"oceanQuadrupleRoomCounts"};if(v.value==="全部")for(const s in c){const r=c[s],a=N(F,"counts",r),l=await T(a);l.exists()&&(h.value[s]=l.data())}else{const s=c[v.value],r=N(F,"counts",s),a=await T(r);a.exists()&&(h.value[v.value]=a.data())}B(),o.close()};w(()=>{q()});const B=()=>{const o=f(U(u.value)),c=Object.keys(h.value),s={};c.forEach(r=>{s[r]=1/0});for(let r=0;r<=C.value;r++){const l=o.add(r,"day").format("YYYY-MM-DD");c.forEach(t=>{const p=h.value[t];p&&p[l]!==void 0?s[t]=Math.min(s[t],p[l]):s[t]=0})}D.value=s};x([u,m,h],B);const O=o=>{let c=0;const s=f(u.value),r=f(m.value);for(let a=s;a.isBefore(r);a=a.add(1,"day")){const l=a.day();let t=0;y.value.forEach(p=>{p.name===o&&(t+=parseInt(p.price),(l===0||l===6)&&(t+=1e3))}),c+=t}return c},C=n(""),Y=()=>{const o=f(u.value),s=f(m.value).diff(o,"day");C.value=s};x([u,m],Y),Y();const $=se();function j(o){$.currentUser?o.number>D.value[o.name]?Q.alert("剩餘房間不足","提示",{confirmButtonText:"OK"}):k.push({path:"/reserve/confirm",query:{date1:u.value,date2:m.value,day:C.value,number:o.number,reservePrice:O(o.name),room:o.name}}):Q.alert("請先登入會員","提示",{confirmButtonText:"OK",callback:()=>{k.push({path:"/member",query:{redirect:k.currentRoute.value.fullPath}})}})}const k=te();function z(){k.push({path:"/reserve"})}return(o,c)=>{const s=E("el-option"),r=E("el-select");return I(),g(M,null,[ie,e("div",de,[(I(!0),g(M,null,L(y.value,(a,l)=>(I(),g("div",{class:"room",key:l},[e("div",me,[e("img",{src:a.pic},null,8,ve)]),e("div",_e,[e("div",pe,i(a.name),1),e("div",fe,[e("div",he,[be,e("span",null,i(u.value),1)]),e("div",ye,[De,e("span",null,i(m.value),1)]),e("div",Ce,[ke,e("span",null,i(C.value)+"天",1)]),e("div",xe,[Ie,e("span",null,"NT$"+i(P(a.price)),1)]),e("div",ge,[Pe,e("span",null,"NT$"+i(P(parseInt(a.price)+1e3)),1)]),e("div",Re,[Me,e("span",{style:ce({color:D.value[a.name]<2?"red":"black"})},i(D.value[a.name]),5)]),e("div",Se,[qe,e("span",null,[V(r,{modelValue:a.number,"onUpdate:modelValue":t=>a.number=t},{default:re(()=>[(I(),g(M,null,L(5,t=>V(s,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),e("div",Be," 總計:NT$"+i(P(O(a.name)*a.number)),1)]),e("div",{class:"reserve",onClick:t=>j(a)},"立即訂房",8,Oe)])]))),128))]),e("div",{class:"back",onClick:z},"上一步")],64)}}},Le=ee(Ye,[["__scopeId","data-v-035f933d"]]);export{Le as default};
